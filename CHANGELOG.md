# Changelog - Обновление конфигурации паролей

## Обновления скриптов для использования паролей из secrets.env

### Обновленные файлы:

1. **setup_elasticsearch_users.sh**
   - Добавлена загрузка паролей из `secrets.env` или `/app/secrets.env`
   - Поддержка работы в Docker и локально

2. **setup_elasticsearch_users.py**
   - Добавлена загрузка паролей через `python-dotenv` из `secrets.env`
   - Поддержка путей `/app/secrets.env` для Docker

3. **generate_kafka_jaas.sh**
   - Улучшена загрузка `secrets.env` с проверкой нескольких путей
   - Безопасная загрузка переменных окружения

4. **generate_kafka_jaas.py**
   - Уже использовал `dotenv` для загрузки `secrets.env`
   - Без изменений (уже корректно работает)

5. **docker-compose.yml**
   - Добавлен `env_file: - secrets.env` для всех сервисов:
     - `generate-kafka-config` - генерация конфигурации Kafka
     - `kafka` - брокер Kafka
     - `elasticsearch` - сервер Elasticsearch
     - `kibana` - Kibana
     - `setup-elasticsearch` - настройка пользователей
     - `indexer` - сервис индексирования
     - `api` - HTTP API
   - Все сервисы теперь автоматически загружают пароли из `secrets.env`

### Как это работает:

1. **При запуске Docker Compose:**
   - Все сервисы автоматически загружают переменные из `secrets.env` через `env_file`
   - Скрипты настройки читают пароли из файла или переменных окружения
   - Приоритет: переменные окружения > secrets.env > значения по умолчанию

2. **Локальный запуск:**
   - Скрипты Python используют `python-dotenv` для загрузки `secrets.env`
   - Bash скрипты используют `source` для загрузки переменных
   - Все скрипты проверяют несколько возможных путей к файлу

### Безопасность:

- ✅ Пароли хранятся только в `secrets.env`
- ✅ `secrets.env` в `.gitignore` и не коммитится
- ✅ Все скрипты используют пароли из файла, а не хардкод
- ✅ Поддержка переменных окружения для переопределения

### Использование:

1. Создайте `secrets.env` с паролями (или используйте `generate_secrets.py`)
2. Запустите `docker-compose up` - все сервисы автоматически загрузят пароли
3. Для локального запуска скриптов - они автоматически найдут `secrets.env`
